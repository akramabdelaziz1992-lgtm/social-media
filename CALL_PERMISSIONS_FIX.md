# โ ุฅุตูุงุญ CORS ูุฅุถุงูุฉ ุตูุงุญูุงุช ุงูุงุณุชูุงุน ููููุงููุงุช

## ๐ ุงููุดุงูู ุงูุชู ุชู ุญููุง

### 1. ูุดููุฉ CORS โ โ โ
**ุงููุดููุฉ**: 
```
Access to fetch at 'https://your-render-url.onrender.com/api/users' 
from origin 'https://almasar-frontend.vercel.app' has been blocked by CORS policy
```

**ุงูุณุจุจ**:
- ูู `employees/page.tsx` ูุงู ูุณุชุฎุฏู `NEXT_PUBLIC_API_BASE_URL` ุจุฏูุงู ูู `NEXT_PUBLIC_API_URL`
- ูุฐุง ุฌุนู ุงูู URL ุฎุทุฃ: `your-render-url.onrender.com`

**ุงูุญู**:
```typescript
// ูุจู โ
const apiUrl = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:4000';

// ุจุนุฏ โ
const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:4000';
```

---

### 2. ุฅุถุงูุฉ ุตูุงุญูุงุช ุงูุงุณุชูุงุน ๐ง

#### ุงูุตูุงุญูุงุช ุงูุฌุฏูุฏุฉ:

| ุงูุตูุงุญูุฉ | ุงููุตู | ุงูููุฏ |
|---------|-------|------|
| ๐ง ุณูุงุน ููุงููุงุชู | ูุณูุญ ููููุธู ุจุณูุงุน ููุงููุงุชู ููุท | `listen_own_calls` |
| ๐ ุณูุงุน ูู ุงูููุงููุงุช | ูุณูุญ ููููุธู ุจุณูุงุน ูู ุงูููุงููุงุช | `listen_all_calls` |

#### ุชุทุจูู ุงูุตูุงุญูุงุช ูู UI:

```typescript
// ูู mobile-call/page.tsx - ูุญุต ุงูุตูุงุญูุงุช
const userPermissions = currentUser?.permissions || [];
const canListenOwnCalls = userPermissions.includes('listen_own_calls');
const canListenAllCalls = userPermissions.includes('listen_all_calls');
const isOwnCall = call.employeeName === currentUser?.name;
const isAdmin = currentUser?.role === 'admin';

// ุฅุธูุงุฑ ุฒุฑ ุงูุงุณุชูุงุน ุฅุฐุง:
const canListen = isAdmin || canListenAllCalls || (canListenOwnCalls && isOwnCall);
```

#### ููุทู ุงูุตูุงุญูุงุช:

1. **Admin** โ ููููู ุณูุงุน **ูู ุงูููุงููุงุช** ุฏุงุฆูุงู
2. **ููุธู ูุฏูู `listen_all_calls`** โ ููููู ุณูุงุน **ูู ุงูููุงููุงุช**
3. **ููุธู ูุฏูู `listen_own_calls`** โ ููููู ุณูุงุน **ููุงููุงุชู ููุท**
4. **ููุธู ุจุฏูู ุตูุงุญูุงุช** โ ูุง ููููู ุณูุงุน **ุฃู ููุงููุงุช**

---

## ๐ง ุงูุชุญุฏูุซุงุช ุงูุจุฑูุฌูุฉ

### 1. Frontend Updates

#### `employees/page.tsx`:
โ ุฅุตูุงุญ API URL  
โ ุฅุถุงูุฉ ุงูุตูุงุญูุงุช ุงูุฌุฏูุฏุฉ ููุงุฆูุฉ ุงูุตูุงุญูุงุช:
```typescript
{ id: 'listen_own_calls', label: '๐ง ุณูุงุน ููุงููุงุชู' },
{ id: 'listen_all_calls', label: '๐ ุณูุงุน ูู ุงูููุงููุงุช' },
```

#### `mobile-call/page.tsx`:
โ ุฅุถุงูุฉ ูุญุต ุงูุตูุงุญูุงุช ูุฒุฑ ุงูุงุณุชูุงุน  
โ ุฅุฎูุงุก ุฒุฑ ุงูุงุณุชูุงุน ุฅุฐุง ูู ููู ูุฏู ุงููุณุชุฎุฏู ุตูุงุญูุฉ  
โ ูุญุต ุฅุฐุง ูุงูุช ุงูููุงููุฉ ุฎุงุตุฉ ุจุงููุณุชุฎุฏู

#### `lib/auth.ts`:
โ ุฅุถุงูุฉ `permissions?: string[]` ุฅูู User interface

### 2. Backend Updates

#### `auth.service.ts`:
โ ุฅุถุงูุฉ `permissions` ุฅูู response ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:
```typescript
return {
  accessToken,
  refreshToken,
  user: {
    id: user.id,
    name: user.name,
    email: user.email,
    role: user.role,
    department: user.department,
    avatar: user.avatar,
    phone: user.phone,
    permissions: user.permissions || [], // โ ุฌุฏูุฏ
  },
};
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช

### ุงูุณููุงุฑูู 1: ููุธู ุจุฏูู ุตูุงุญูุงุช โ
```
ุงูุตูุงุญูุงุช: []
ุงููุชูุฌุฉ: ูุง ูุธูุฑ ุฒุฑ ุงูุงุณุชูุงุน ๐ง ููุงุฆูุงู
```

### ุงูุณููุงุฑูู 2: ููุธู ุจุตูุงุญูุฉ ุณูุงุน ููุงููุงุชู ๐ง
```
ุงูุตูุงุญูุงุช: ['listen_own_calls']
ุงููุชูุฌุฉ: 
  โ ูุธูุฑ ุฒุฑ ุงูุงุณุชูุงุน ูููุงููุงุชู ููุท
  โ ูุง ูุธูุฑ ุฒุฑ ุงูุงุณุชูุงุน ูููุงููุงุช ุงูุขุฎุฑูู
```

### ุงูุณููุงุฑูู 3: ููุธู ุจุตูุงุญูุฉ ุณูุงุน ูู ุงูููุงููุงุช ๐
```
ุงูุตูุงุญูุงุช: ['listen_all_calls']
ุงููุชูุฌุฉ: 
  โ ูุธูุฑ ุฒุฑ ุงูุงุณุชูุงุน ููู ุงูููุงููุงุช
  โ ููููู ุณูุงุน ููุงููุงุช ุฌููุน ุงูููุธููู
```

### ุงูุณููุงุฑูู 4: Admin ๐
```
ุงูุฏูุฑ: 'admin'
ุงููุชูุฌุฉ: 
  โ ูุธูุฑ ุฒุฑ ุงูุงุณุชูุงุน ููู ุงูููุงููุงุช ุฏุงุฆูุงู
  โ ุจุฏูู ุงูุญุงุฌุฉ ูุตูุงุญูุงุช ุฅุถุงููุฉ
```

---

## ๐ ููููุฉ ุชูุนูู ุงูุตูุงุญูุงุช

### 1. ูู ุตูุญุฉ ุงูููุธููู:

1. ุงุฐูุจ ุฅูู: https://almasar-frontend.vercel.app/employees
2. ุงุฎุชุฑ ููุธู ุฃู ุฃุถู ููุธู ุฌุฏูุฏ
3. ูู ูุณู **ุงูุตูุงุญูุงุช**:
   - โ ุงุฎุชุฑ **๐ง ุณูุงุน ููุงููุงุชู** - ุฅุฐุง ููุช ุชุฑูุฏ ุฃู ูุณูุน ููุงููุงุชู ููุท
   - โ ุงุฎุชุฑ **๐ ุณูุงุน ูู ุงูููุงููุงุช** - ุฅุฐุง ููุช ุชุฑูุฏ ุฃู ูุณูุน ูู ุงูููุงููุงุช
4. ุงุญูุธ ุงูุชุบููุฑุงุช

### 2. ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:

- ุงูุตูุงุญูุงุช ูุชู ุชุญููููุง ุชููุงุฆูุงู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
- ูุชู ุญูุธูุง ูู localStorage
- ุชูุทุจู ููุฑุงู ูู ุตูุญุฉ ุงูููุงููุงุช

---

## ๐ ูุซุงู ุนููู

### ุฅุนุฏุงุฏ ููุธู ุฎุฏูุฉ ุนููุงุก:

**ุงูุงุณู**: ุฃุญูุฏ ูุญูุฏ  
**ุงูุจุฑูุฏ**: ahmad@company.com  
**ุงูุตูุงุญูุงุช**:
- โ ุนุฑุถ ุงููุญุงุฏุซุงุช
- โ ุงูุฑุฏ ุนูู ุงูุฑุณุงุฆู
- โ ๐ง ุณูุงุน ููุงููุงุชู โ **ุฌุฏูุฏ**

**ุงููุชูุฌุฉ**:
- ุฃุญูุฏ ููููู ุณูุงุน ููุงููุงุชู ุงูุชู ุฃุฌุฑุงูุง ููุท โ
- ูุง ููููู ุณูุงุน ููุงููุงุช ุงูููุธููู ุงูุขุฎุฑูู โ

---

### ุฅุนุฏุงุฏ ูุดุฑู:

**ุงูุงุณู**: ูุงุทูุฉ ุนูู  
**ุงูุจุฑูุฏ**: fatima@company.com  
**ุงูุตูุงุญูุงุช**:
- โ ุนุฑุถ ุงููุญุงุฏุซุงุช
- โ ุงูุฑุฏ ุนูู ุงูุฑุณุงุฆู
- โ ุชุนููู ุงููุญุงุฏุซุงุช
- โ ุนุฑุถ ุงูุชูุงุฑูุฑ
- โ ๐ ุณูุงุน ูู ุงูููุงููุงุช โ **ุฌุฏูุฏ**

**ุงููุชูุฌุฉ**:
- ูุงุทูุฉ ูููููุง ุณูุงุน ูู ููุงููุงุช ุงููุณู โ
- ูููููุง ูุฑุงุฌุนุฉ ุฃุฏุงุก ุงูููุธููู โ

---

## ๐ฏ ุงูุฎูุงุตุฉ

| ุงููุดููุฉ | ุงูุญู | ุงูุญุงูุฉ |
|---------|------|--------|
| โ CORS Error ูู ุตูุญุฉ ุงูููุธููู | ุชุตุญูุญ API URL | โ ูุญููู |
| โ ูุง ุชูุฌุฏ ุตูุงุญูุฉ ูุณูุงุน ุงูููุงููุงุช | ุฅุถุงูุฉ `listen_own_calls` | โ ูุถุงู |
| โ ูุง ุชูุฌุฏ ุตูุงุญูุฉ ูุณูุงุน ููุงููุงุช ุงูุขุฎุฑูู | ุฅุถุงูุฉ `listen_all_calls` | โ ูุถุงู |
| โ ุฒุฑ ุงูุงุณุชูุงุน ูุธูุฑ ููุฌููุน | ูุญุต ุงูุตูุงุญูุงุช ูุจู ุงูุฅุธูุงุฑ | โ ูุทุจู |

---

## ๐ Git Commits

```bash
Commit: ea4c2da
Message: Fix CORS issue and add call listening permissions

Files Changed:
- backend/src/modules/auth/auth.service.ts      (+2)
- frontend/app/employees/page.tsx                (+2)
- frontend/app/mobile-call/page.tsx              (+25)
- frontend/lib/auth.ts                           (+1)
```

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ**: ุฏูุณูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ**: 2.1.0  
**Commit**: ea4c2da
