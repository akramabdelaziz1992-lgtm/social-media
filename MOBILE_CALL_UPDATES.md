# ุชุญุฏูุซุงุช ุฑุจุท ุชุทุจูู ููุจุงูู ููู - Mobile Call Integration

## ๐ ููุฎุต ุงูุชุญุฏูุซุงุช

ุชู ุฑุจุท ุชุทุจูู ููุจุงูู ููู (Softphone) ุจุงููุธุงู ุงูุฑุฆูุณู ุจูุฌุงุญ! ุงูุขู ุฌููุน ุงูููุงููุงุช ุงูุชู ุชุชู ูู ุงูุชุทุจูู ูุชู ุชุณุฌูููุง ุชููุงุฆูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุนุฑุถูุง ูู ุตูุญุฉ unified-number.

---

## ๐ฏ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. **ุชูุงูู ูุงูู ูุน Backend API**
- โ ุฌููุน ุงูููุงููุงุช ูู ููุจุงูู ููู ุชูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุญูุธ ุชูุงุตูู ุงูููุงููุฉ (ุงูุฑููุ ุงููุฏุฉุ ุงูุชุงุฑูุฎุ ุงูุญุงูุฉ)
- โ ุฑุจุท ุงูููุงููุงุช ุจู Twilio Call SID ููุชุชุจุน
- โ ุชุณุฌูู ุชููุงุฆู ูุฌููุน ุงูููุงููุงุช

### 2. **ูุชุญ ุงูุชุทุจูู ูู ุตูุญุฉ Unified Number**
- โ ุฒุฑ ุฌุฏูุฏ "ููุจุงูู ููู" ูู ุตูุญุฉ unified-number
- โ ูุชุญ ุงูุชุทุจูู ุชููุงุฆูุงู ุจุถุบุทุฉ ูุงุญุฏุฉ
- โ ุงูุชุทุจูู ูุธูุฑ ูู ุงูููุฏูุฉ ุนูุฏ ูุชุญู

### 3. **ุนุฑุถ ุณุฌู ุงูููุงููุงุช ุงูุญูููู**
- โ ุฌูุจ ุงูููุงููุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุชุญุฏูุซ ุชููุงุฆู ูู 30 ุซุงููุฉ
- โ ุนุฑุถ ุงูููุงููุงุช ุงููุงุฑุฏุฉ ูุงูุตุงุฏุฑุฉ
- โ ุนุฑุถ ูุฏุฉ ุงูููุงููุฉ ูุญุงูุชูุง

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### Backend (ูุง ุชูุฌุฏ ุชุนุฏููุงุช - ุฌุงูุฒ ูุณุจูุงู)
- โ `backend/src/modules/calls/calls.controller.ts` - API endpoints ุฌุงูุฒุฉ
- โ `backend/src/modules/calls/calls.service.ts` - Services ุฌุงูุฒุฉ
- โ `backend/src/modules/calls/entities/call.entity.ts` - Database model ุฌุงูุฒ

### Frontend
- โ `frontend/app/unified-number/page.tsx`:
  - ุฅุถุงูุฉ ุฒุฑ "ููุจุงูู ููู"
  - ุฅุถุงูุฉ ุฏุงูุฉ `openSoftphone()`
  - ุฅุถุงูุฉ `loadCallRecords()` ูุฌูุจ ุงูููุงููุงุช
  - ุฅุถุงูุฉ `useEffect` ููุชุญุฏูุซ ุงูุชููุงุฆู
  - ุนุฑุถ ุงูููุงููุงุช ุงูุญููููุฉ

### Softphone
- โ `softphone/main.js`:
  - ุฅุถุงูุฉ `show-window` IPC handler
  - ุฅุถุงูุฉ `quit-app` IPC handler

- โ `softphone/renderer.js`:
  - ุชุญุฏูุซ `makeCall()` ููุงุชุตุงู ุจู API
  - ุชุญุฏูุซ `endCall()` ูุฅุฑุณุงู ุญุงูุฉ ุงูููุงููุฉ
  - ุญูุธ `callSid` ููุชุชุจุน
  - ุฅุฑุณุงู ุฃุญุฏุงุซ WebSocket

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุงูุทุฑููุฉ 1๏ธโฃ: ูู ุตูุญุฉ Unified Number

```
1. ุงูุชุญ ุงููุชุตูุญ
2. ุงุฐูุจ ุฅูู: http://localhost:3000/unified-number
3. ุงุถุบุท ุนูู ุฒุฑ "ููุจุงูู ููู" ๐ (ุงูุฃุฒุฑู)
4. ุณููุชุญ ุชุทุจูู ููุจุงูู ููู ุชููุงุฆูุงู
```

### ุงูุทุฑููุฉ 2๏ธโฃ: ุชุดุบูู ุงูุชุทุจูู ูุจุงุดุฑุฉ

**PowerShell:**
```powershell
cd "d:\social media\almasar-suite"
.\launch-mobile-call.ps1
```

**ุฃู ูู ูุฌูุฏ ุงูุชุทุจูู:**
```powershell
cd "d:\social media\almasar-suite\softphone"
npm start
```

---

## ๐ ุฅุฌุฑุงุก ููุงููุฉ

### ูู ุชุทุจูู ููุจุงูู ููู:

1. **ุฃุฏุฎู ุฑูู ุงููุงุชู** ูู ุญูู ุงูุฅุฏุฎุงู
   - ูุซุงู: `+966501234567`
   - ุฃู: `0501234567`

2. **ุงุถุบุท ุฒุฑ ุงูุงุชุตุงู** โ๏ธ

3. **ุณูุญุฏุซ ุงูุชุงูู:**
   ```
   โ ุงููุธุงู ูุชุตู ุจุงูููุธู ุฃููุงู (+966559902557)
   โก ุนูุฏ ุฑุฏ ุงูููุธูุ ูุณูุน: "ูุฑุญุจุงู. ุงูุขู ุฌุงุฑู ุงูุงุชุตุงู ุจุงูุนููู"
   โข ุงููุธุงู ูุชุตู ุจุงูุนููู
   โฃ ูุชู ุฑุจุท ุงูููุงููุฉ ุจูู ุงูููุธู ูุงูุนููู
   โค ุชุณุฌูู ุงูููุงููุฉ ุชููุงุฆูุงู โ
   โฅ ุญูุธ ุงูููุงููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช โ
   ```

4. **ุฃุซูุงุก ุงูููุงููุฉ:**
   - ูุชู ุงูุตูุช ๐
   - ุฅููุงุก ุงูููุงููุฉ ๐ต

5. **ุจุนุฏ ุฅููุงุก ุงูููุงููุฉ:**
   - ุชูุญูุธ ุงููุฏุฉ ุชููุงุฆูุงู
   - ุชูุญุฏุซ ุงูุญุงูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุชุธูุฑ ูู ุณุฌู ุงูููุงููุงุช

---

## ๐ ุนุฑุถ ุณุฌู ุงูููุงููุงุช

### ูู ุตูุญุฉ Unified Number:

1. ุงุฐูุจ ุฅูู `http://localhost:3000/unified-number`
2. ุงููุฑ ุนูู ุชุจููุจ **"ุณุฌู ุงูููุงููุงุช"**
3. ุณุชุฑู:
   - โ ุฌููุน ุงูููุงููุงุช ูู ููุจุงูู ููู
   - โ ุงูููุงููุงุช ุงููุงุฑุฏุฉ ูู Twilio
   - โ ุงูููุงููุงุช ูู ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ
   - โ ุงูุชุณุฌููุงุช ุงูุตูุชูุฉ (ุฅู ูุฌุฏุช)

### ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ:
```
๐ฑ ุฑูู ุงููุงุชู
๐ค ุงุณู ุงูุนููู (ุฅู ูุฌุฏ)
โฑ๏ธ ูุฏุฉ ุงูููุงููุฉ
๐ ุชุงุฑูุฎ ูููุช ุงูููุงููุฉ
๐ ุญุงูุฉ ุงูููุงููุฉ (ููุชููุฉ/ูุงุฆุชุฉ/ุฌุงุฑูุฉ)
๐๏ธ ุชุณุฌูู ุงูููุงููุฉ
```

---

## ๐๏ธ ุงูุจูุงูุงุช ุงููุญููุธุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

ูู ููุงููุฉ ุชุญุชูู ุนูู:

```typescript
{
  id: string;                    // ูุนุฑู ุงูููุงููุฉ
  twilioCallSid: string;         // ูุนุฑู Twilio
  fromNumber: string;            // ุฑูู ุงููุชุตู
  toNumber: string;              // ุฑูู ุงููุณุชูุจู
  direction: 'inbound' | 'outbound';  // ุงูุงุชุฌุงู
  status: 'initiated' | 'ringing' | 'in-progress' | 'completed' | 'failed';
  durationSeconds: number;       // ุงููุฏุฉ ุจุงูุซูุงูู
  recordingUrl: string;          // ุฑุงุจุท ุงูุชุณุฌูู
  agentId: string;               // ูุนุฑู ุงูููุธู
  agentName: string;             // ุงุณู ุงูููุธู
  createdAt: Date;               // ุชุงุฑูุฎ ุงูุจุฏุก
  endedAt: Date;                 // ุชุงุฑูุฎ ุงูุงูุชูุงุก
}
```

---

## ๐ง ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู

ูููู ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุช ูู ุชุทุจูู ููุจุงูู ููู:

### ุชุจููุจ Settings โ๏ธ:

1. **ุนููุงู ุงูุฎุงุฏู (Server URL)**
   - ุงูุงูุชุฑุงุถู: `http://localhost:4000`
   - ูููู ุชุบููุฑู ูุฎุงุฏู ุจุนูุฏ

2. **ุงูุงุชุตุงู ุงูุชููุงุฆู (Auto Connect)**
   - ููุนูู: ูุชุตู ุจุงูุฎุงุฏู ุชููุงุฆูุงู
   - ูุนุทูู: ูุชุทูุจ ุงุชุตุงู ูุฏูู

3. **ุงูุฅุดุนุงุฑุงุช (Notifications)**
   - ููุนููุฉ: ุฅุดุนุงุฑุงุช ุณุทุญ ุงูููุชุจ
   - ูุนุทููุฉ: ุจุฏูู ุฅุดุนุงุฑุงุช

---

## ๐ API Endpoints ุงููุณุชุฎุฏูุฉ

### 1. ุฅุฌุฑุงุก ููุงููุฉ ุฌุฏูุฏุฉ
```http
POST /api/calls/make-call
Content-Type: application/json

{
  "to": "+966501234567",
  "from": "+18154860356",
  "agentPhone": "+966559902557"
}
```

### 2. ุชุญุฏูุซ ุญุงูุฉ ุงูููุงููุฉ
```http
POST /api/calls/webhook/status
Content-Type: application/json

{
  "CallSid": "CAxxxx",
  "CallStatus": "completed",
  "CallDuration": "120"
}
```

### 3. ุฌูุจ ุฌููุน ุงูููุงููุงุช
```http
GET /api/calls
```

### 4. ุฌูุจ ุฅุญุตุงุฆูุงุช ุงูููุงููุงุช
```http
GET /api/calls/stats
```

---

## ๐๏ธ ุงูุชุณุฌูู ุงูุชููุงุฆู

ุฌููุน ุงูููุงููุงุช ูุชู ุชุณุฌูููุง ุชููุงุฆูุงู:

- **ุงูุจุฏุงูุฉ**: ูู ูุญุธุฉ ุฑุฏ ุงูุนููู
- **ุงูุฌูุฏุฉ**: HD
- **ุงูุชุฎุฒูู**: Twilio Cloud
- **ุงููุฏุฉ**: ุญุณุจ ุฅุนุฏุงุฏุงุช Twilio (ุงูุชุฑุงุถู: 1 ุณุงุนุฉ ูุญุฏ ุฃูุตู)
- **ุงูุตูุบุฉ**: MP3
- **ุงููุตูู**: ุนุจุฑ `recordingUrl` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุชูุฒูู ุงูุชุณุฌูู:
```javascript
const recordingUrl = call.recordingUrl;
// ูููู ุชูุฒููู ูุจุงุดุฑุฉ ูู Twilio
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุชุทุจูู ูุง ููุชุญ ูู ุตูุญุฉ unified-number

**ุงูุณุจุจ**: ุงูุชุทุจูู ุบูุฑ ูุดุบู

**ุงูุญู**:
```powershell
cd "d:\social media\almasar-suite\softphone"
npm start
```

---

### ุงููุดููุฉ: ุงูููุงููุงุช ูุง ุชูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุณุจุจ**: Backend ุบูุฑ ูุชุตู

**ุงูุญู**:
```powershell
# ุชุญูู ูู Backend
curl http://localhost:4000/api/calls

# ุฃู ุดุบูู Backend
cd "d:\social media\almasar-suite\backend"
npm run start:dev
```

---

### ุงููุดููุฉ: ูุง ููุฌุฏ ุตูุช ุฃุซูุงุก ุงูููุงููุฉ

**ุงูุณุจุจ**: ุฑูู ุงูููุธู ุบูุฑ ุตุญูุญ ุฃู ูู ูุชู ุงูุชุญูู ููู ูู Twilio

**ุงูุญู**:
1. ุชุญูู ูู ุฑูู ุงูููุธู ูู ุฅุนุฏุงุฏุงุช Twilio
2. ุชุฃูุฏ ูู ุงูุชุญูู ูู ุงูุฑูู (Verified Caller ID)

---

### ุงููุดููุฉ: ุฎุทุฃ "Failed to fetch" ุนูุฏ ุงูุงุชุตุงู

**ุงูุณุจุจ**: CORS ุฃู Backend ูุง ูุนูู

**ุงูุญู**:
```powershell
# ุชุญูู ูู Backend
cd backend
npm run start:dev

# ุชุญูู ูู CORS settings ูู backend/src/main.ts
```

---

## ๐ ุงูุฃุฑูุงู ุงููุณุชุฎุฏูุฉ

| ุงูููุน | ุงูุฑูู | ุงููุตู |
|------|-------|-------|
| Twilio | `+18154860356` | ุฑูู Twilio ุงูุฃูุฑููู |
| ุงูููุธู | `+966559902557` | ุฑูู ุงูููุธู ุงูุณุนูุฏู |
| ูุฑูุฒ ุงูุงุชุตุงูุงุช | `0555254915` | ุฑูู ุงููุฑูุฒ |

---

## ๐ฏ ุงูููุฒุงุช ุงููุณุชูุจููุฉ

- [ ] ุฏุนู ุนุฏุฉ ููุธููู
- [ ] ูุธุงู ุงูุทูุงุจูุฑ (Queue System)
- [ ] WebRTC ูุจุงุดุฑุฉ (ุจุฏูู Twilio)
- [ ] ุชูุงูู ูุน WhatsApp Business
- [ ] ุฅุดุนุงุฑุงุช ุงูููุงููุงุช ุงููุงุฑุฏุฉ
- [ ] ุชูุงุฑูุฑ ุชูุตูููุฉ ููุฃุฏุงุก
- [ ] ุชุณุฌูู ูุญูู ููููุงููุงุช
- [ ] ููู ุงูููุงููุงุช ุจูู ุงูููุธููู
- [ ] ููุงููุงุช ุฌูุงุนูุฉ (Conference)
- [ ] IVR ูุชูุฏู

---

## ๐ ุงููููุงุช ุงูุฅุถุงููุฉ

ุชู ุฅูุดุงุก ุงููููุงุช ุงูุชุงููุฉ:

1. **`softphone/INTEGRATION_GUIDE.md`** - ุฏููู ุงูุฑุจุท ุงูุชูุตููู
2. **`softphone/launch-softphone.ps1`** - Script ูุชุดุบูู ุงูุชุทุจูู
3. **`launch-mobile-call.ps1`** - Script ุฑุฆูุณู ููุชุดุบูู ุงูุณุฑูุน
4. **`MOBILE_CALL_UPDATES.md`** - ูุฐุง ุงูููู (ุงูุชูุซูู ุงููุงูู)

---

## โ ุงูุฎูุงุตุฉ

ุชู ุฑุจุท ุชุทุจูู ููุจุงูู ููู ุจูุฌุงุญ ูุน ุงููุธุงู ุงูุฑุฆูุณู! ุงูุขู:

โ ุฌููุน ุงูููุงููุงุช ุชูุณุฌู ุชููุงุฆูุงู
โ ุณุฌู ุงูููุงููุงุช ูุชุฒุงูู ุจูู ุงูุชุทุจูู ูุงููุธุงู
โ ูููู ูุชุญ ุงูุชุทุจูู ูู ุตูุญุฉ unified-number
โ ุงูุชุณุฌููุงุช ุงูุตูุชูุฉ ูุชุงุญุฉ ููุงุณุชูุงุน
โ ุฅุญุตุงุฆูุงุช ุงูููุงููุงุช ุฏูููุฉ ููุญุฏุซุฉ

---

## ๐ก ูุตุงุฆุญ ุงูุงุณุชุฎุฏุงู

1. **ููููุธููู**: ุดุบูู ุชุทุจูู ููุจุงูู ููู ูุงุจูู ูู ุงูุฎูููุฉ
2. **ูููุฏุฑุงุก**: ุงุณุชุฎุฏู ุตูุญุฉ unified-number ููุฑุงูุจุฉ ุงูููุงููุงุช
3. **ููุฅุญุตุงุฆูุงุช**: ุฑุงุฌุน ุชุจููุจ Analytics ูู unified-number
4. **ููุชุณุฌููุงุช**: ุงุถุบุท ุนูู ุฃููููุฉ ุงูุณูุงุนุฉ ุจุฌุงูุจ ูู ููุงููุฉ

---

๐ **ูุจุฑูู! ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู**

ุชุงุฑูุฎ ุงูุชุญุฏูุซ: 24 ููููุจุฑ 2025
ุงูุฅุตุฏุงุฑ: 1.0.0
